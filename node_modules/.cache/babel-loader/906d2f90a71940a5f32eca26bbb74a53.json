{"ast":null,"code":"var _jsxFileName = \"/Users/neelpatel/Desktop/Classes/342/Project/frontend-react/src/components/pages/Checkout.js\";\nimport React from 'react';\nimport { Redirect } from \"react-router-dom\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default class Checkout extends React.Component {\n  constructor(props) {\n    super(props);\n    let token = document.cookie.split('; ').find(row => row.startsWith('token'));\n    token = token.split('=')[1];\n    var user;\n    let cart = [];\n\n    if (this.props.location.state === undefined) {\n      user = \"\";\n    } else {\n      user = this.props.location.state.user;\n      cart = this.props.location.state.cart;\n    }\n\n    let newItems = cart;\n    let totalPrice = 0;\n\n    for (let i = 0; i < newItems.length; i++) {\n      newItems[i].totalPriceForItem = +newItems[i].price * +newItems[i].amountToBuy;\n      totalPrice += newItems[i].totalPriceForItem;\n      newItems[i].totalPriceForItem = Math.round(newItems[i].totalPriceForItem * 100) / 100;\n      totalPrice = Math.round(totalPrice * 100) / 100;\n    }\n\n    this.state = {\n      user: user,\n      items: newItems,\n      total: totalPrice,\n      token: token\n    };\n    this.onShop = this.onShop.bind(this);\n    this.clearCart = this.clearCart.bind(this);\n    this.calculateTotal = this.calculateTotal.bind(this);\n    this.updateItemInCart = this.updateItemInCart.bind(this);\n    this.removeFromCart = this.removeFromCart.bind(this);\n    this.purchase = this.purchase.bind(this);\n  }\n\n  calculateTotal() {\n    let newTotal = 0;\n\n    for (let i = 0; i < this.state.items.length; i++) {\n      newTotal += this.state.items[i].totalPriceForItem;\n    }\n\n    newTotal = Math.round(newTotal * 100) / 100;\n    this.setState({\n      total: newTotal\n    });\n  }\n\n  onShop() {\n    this.setState({\n      shop: true\n    });\n  }\n\n  clearCart() {\n    this.setState({\n      items: []\n    });\n    this.setState({\n      total: 0\n    });\n  }\n\n  updateItemInCart(idx, isDelivery) {\n    let newItems = this.state.items;\n    newItems[idx].totalPriceForItem = +newItems[idx].price * +newItems[idx].amountToBuy;\n\n    if (isDelivery) {\n      newItems[idx].totalPriceForItem = +newItems[idx].totalPriceForItem + +newItems[idx].deliveryFee;\n    }\n\n    newItems[idx].totalPriceForItem = Math.round(newItems[idx].totalPriceForItem * 100) / 100;\n    this.setState({\n      items: newItems\n    });\n    this.calculateTotal();\n  }\n\n  removeFromCart(idx) {\n    let newItems = this.state.items;\n    newItems.splice(idx, 1);\n    this.setState({\n      items: newItems\n    });\n    this.calculateTotal();\n  }\n\n  async deleteFood(seller, name) {\n    await fetch(`http://localhost:8080/foodItems/${name}`, {\n      method: 'DELETE',\n      credentials: 'include',\n      headers: {\n        'Authorization': `Bearer ${this.state.token}`\n      }\n    }).then(response => {// Do nothing\n    }).catch(err => {\n      throw new Error(err);\n    });\n  }\n\n  async putFood(newItem) {\n    await fetch('http://localhost:8080/foodItems', {\n      method: 'PUT',\n      credentials: 'include',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${this.state.token}`\n      },\n      body: JSON.stringify(newItem)\n    }).then(response => {// Do nothing\n    }).catch(err => {\n      throw new Error(err);\n    });\n  }\n\n  async purchase() {\n    if (this.state.items.length <= 0) {\n      return;\n    }\n\n    for (let i = 0; i < this.state.items.length; i++) {\n      let newItem = {\n        seller: this.state.items[i].seller,\n        name: this.state.items[i].name,\n        price: this.state.items[i].price,\n        amount: this.state.items[i].quantity,\n        pickup: this.state.items[i].pickup,\n        delivery: this.state.items[i].deliveryFee\n      };\n\n      if (newItem.amount <= 0) {\n        await this.deleteFood(newItem.seller, newItem.name);\n      } else {\n        await this.putFood(newItem);\n      }\n\n      console.log(newItem);\n      console.log(this.state.items[i]);\n    }\n\n    this.setState({\n      items: []\n    });\n    this.setState({\n      total: 0\n    });\n    alert(\"Thank you for your purchase!\");\n  }\n\n  renderCards() {\n    var cards = [];\n\n    for (let i = 0; i < this.state.items.length; i++) {\n      cards.push( /*#__PURE__*/_jsxDEV(Card, {\n        id: i,\n        seller: this.state.items[i].seller,\n        name: this.state.items[i].name,\n        totalPriceForItem: this.state.items[i].totalPriceForItem,\n        amountToBuy: this.state.items[i].amountToBuy,\n        pickup: this.state.items[i].pickup,\n        delivery: this.state.items[i].deliveryFee,\n        updateItemInCart: this.updateItemInCart,\n        removeFromCart: this.removeFromCart\n      }, i, false, {\n        fileName: _jsxFileName,\n        lineNumber: 139,\n        columnNumber: 18\n      }, this));\n    }\n\n    return cards;\n  }\n\n  render() {\n    if (this.state.user === \"\") {\n      return /*#__PURE__*/_jsxDEV(Redirect, {\n        to: \"/\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 159,\n        columnNumber: 11\n      }, this);\n    }\n\n    if (this.state.shop) {\n      return /*#__PURE__*/_jsxDEV(Redirect, {\n        to: {\n          pathname: '/Shop',\n          state: {\n            user: this.state.user,\n            cart: this.state.items\n          }\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 165,\n        columnNumber: 9\n      }, this);\n    }\n\n    return /*#__PURE__*/_jsxDEV(React.Fragment, {\n      children: /*#__PURE__*/_jsxDEV(\"section\", {\n        className: \"content-container\",\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          className: \"pageheader\",\n          children: [\"Total: $\", this.state.total]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 173,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"selectButton\",\n          onClick: this.purchase,\n          children: \"Purchase\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 174,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"selectButton\",\n          onClick: this.onShop,\n          children: \"Return to shopping\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 177,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"selectButton\",\n          onClick: this.clearCart,\n          children: \"Clear Cart\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 180,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 183,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 184,\n          columnNumber: 11\n        }, this), this.renderCards(), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 188,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 170,\n      columnNumber: 7\n    }, this);\n  }\n\n}\n\nclass Card extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      amountToBuy: 0,\n      isDelivery: false\n    };\n    this.handleCheckboxChange = this.handleCheckboxChange.bind(this);\n  }\n\n  handleCheckboxChange(event) {\n    const checked = event.target.checked;\n    this.setState({\n      [event.target.name]: checked\n    });\n    this.props.updateItemInCart(this.props.id, checked);\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"itemColumns\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"itemValues\",\n        align: \"center\",\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"Seller: \", this.props.seller[0].name]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 220,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"Name: \", this.props.name]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 221,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"Pickup: \", this.props.pickup]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 222,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"Delivery: $\", this.props.delivery]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 223,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 224,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"Amount to buy: \", this.props.amountToBuy]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 225,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"Total price: $\", this.props.totalPriceForItem]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 226,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"itemButton\",\n          onClick: () => {\n            this.props.removeFromCart(this.props.id);\n          },\n          children: \"Remove from Cart\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 228,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"checkbox\",\n          id: \"delivery\",\n          name: \"isDelivery\",\n          checked: this.state.isDelivery,\n          onChange: this.handleCheckboxChange\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 231,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          htmlFor: \"delivery\",\n          children: \" Delivery?\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 232,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 219,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 218,\n      columnNumber: 7\n    }, this);\n  }\n\n}","map":{"version":3,"sources":["/Users/neelpatel/Desktop/Classes/342/Project/frontend-react/src/components/pages/Checkout.js"],"names":["React","Redirect","Checkout","Component","constructor","props","token","document","cookie","split","find","row","startsWith","user","cart","location","state","undefined","newItems","totalPrice","i","length","totalPriceForItem","price","amountToBuy","Math","round","items","total","onShop","bind","clearCart","calculateTotal","updateItemInCart","removeFromCart","purchase","newTotal","setState","shop","idx","isDelivery","deliveryFee","splice","deleteFood","seller","name","fetch","method","credentials","headers","then","response","catch","err","Error","putFood","newItem","body","JSON","stringify","amount","quantity","pickup","delivery","console","log","alert","renderCards","cards","push","render","pathname","Card","handleCheckboxChange","event","checked","target","id"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Redirect } from \"react-router-dom\";\n\nexport default class Checkout extends React.Component {\n  constructor(props) {\n    super(props);\n    \n    let token = document.cookie.split('; ').find(row => row.startsWith('token'));\n    token = token.split('=')[1];\n\n    \n    var user;\n    let cart = [];\n    if (this.props.location.state === undefined) {\n      user = \"\";\n    } else {\n      user = this.props.location.state.user;\n      cart = this.props.location.state.cart;\n    }\n\n    let newItems = cart;\n    let totalPrice = 0;\n    for (let i = 0; i < newItems.length; i++) {\n      newItems[i].totalPriceForItem = +newItems[i].price * +newItems[i].amountToBuy;\n      totalPrice += newItems[i].totalPriceForItem;\n\n      newItems[i].totalPriceForItem = Math.round(newItems[i].totalPriceForItem * 100) / 100;\n      totalPrice = Math.round(totalPrice * 100) / 100;\n    }\n\n    this.state = {\n      user: user,\n      items: newItems,\n      total: totalPrice,\n      token: token,\n    };\n\n    this.onShop=this.onShop.bind(this);\n    this.clearCart=this.clearCart.bind(this);\n    this.calculateTotal=this.calculateTotal.bind(this);\n    this.updateItemInCart=this.updateItemInCart.bind(this);\n    this.removeFromCart=this.removeFromCart.bind(this);\n    this.purchase=this.purchase.bind(this);\n  }\n\n  calculateTotal() {\n    let newTotal = 0;\n    for (let i = 0; i < this.state.items.length; i++) {\n      newTotal += this.state.items[i].totalPriceForItem;\n    }\n    newTotal = Math.round(newTotal * 100) / 100;\n    this.setState({ total: newTotal });\n  }\n\n  onShop() {\n    this.setState({ shop: true });\n  }\n\n  clearCart() {\n    this.setState({ items: [] });\n    this.setState({ total: 0 });\n  }\n\n  updateItemInCart(idx, isDelivery) {\n    let newItems = this.state.items;\n    newItems[idx].totalPriceForItem = +newItems[idx].price * +newItems[idx].amountToBuy;\n    if (isDelivery) {\n      newItems[idx].totalPriceForItem = +newItems[idx].totalPriceForItem + +newItems[idx].deliveryFee;\n    }\n    newItems[idx].totalPriceForItem = Math.round(newItems[idx].totalPriceForItem * 100) / 100;\n    this.setState( {items: newItems });\n    this.calculateTotal();\n  }\n\n  removeFromCart(idx) {\n    let newItems = this.state.items;\n    newItems.splice(idx, 1);\n    this.setState( {items: newItems });\n    this.calculateTotal();\n  }\n\n  async deleteFood(seller, name) {\n    await fetch(`http://localhost:8080/foodItems/${name}`, {\n      method: 'DELETE',\n      credentials: 'include',\n      headers: {\n        'Authorization': `Bearer ${this.state.token}`,\n      },\n    }).then(response => {\n      // Do nothing\n    })\n    .catch(err => {\n      throw new Error(err)\n    })\n  }\n\n  async putFood(newItem) {\n    await fetch('http://localhost:8080/foodItems', {\n      method: 'PUT',\n      credentials: 'include',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${this.state.token}`,\n      },\n      body: JSON.stringify(newItem)\n    }).then(response => {\n      // Do nothing\n    })\n    .catch(err => {\n      throw new Error(err)\n    })\n  }\n\n  async purchase() {\n    if(this.state.items.length <= 0) {\n      return;\n    }\n    for (let i = 0; i < this.state.items.length; i++) {\n      let newItem = {seller: this.state.items[i].seller, name: this.state.items[i].name,\n                    price: this.state.items[i].price, amount: this.state.items[i].quantity,\n                    pickup: this.state.items[i].pickup, delivery: this.state.items[i].deliveryFee};\n      if (newItem.amount <= 0) {\n        await this.deleteFood(newItem.seller, newItem.name);\n      } else {\n        await this.putFood(newItem);\n      }\n      console.log(newItem);\n      console.log(this.state.items[i]);\n\n    }\n    this.setState({ items: [] });\n    this.setState({ total: 0 });\n    alert(\"Thank you for your purchase!\");\n  }\n\n  renderCards() {\n    var cards = [];\n    for (let i = 0; i < this.state.items.length; i++) {\n      cards.push(<Card\n              key={i}\n              id={i}\n              seller={this.state.items[i].seller}\n              name={this.state.items[i].name}\n              totalPriceForItem={this.state.items[i].totalPriceForItem}\n              amountToBuy={this.state.items[i].amountToBuy}\n              pickup={this.state.items[i].pickup}\n              delivery={this.state.items[i].deliveryFee}\n              updateItemInCart={this.updateItemInCart}\n              removeFromCart={this.removeFromCart}\n            />);\n    }\n    return cards;\n  }\n\n  render() {\n\n    if (this.state.user === \"\") {\n        return(\n          <Redirect to=\"/\" />\n        );\n    }\n\n    if (this.state.shop) {\n      return (\n        <Redirect to={{ pathname: '/Shop', state: { user: this.state.user, cart: this.state.items} }} />\n      );\n    }\n\n    return (\n      <React.Fragment>\n        <section className=\"content-container\">\n          \n          <h2 className=\"pageheader\">Total: ${this.state.total}</h2>\n          <button className=\"selectButton\" onClick={this.purchase}>\n            Purchase\n          </button>\n          <button className=\"selectButton\" onClick={this.onShop}>\n            Return to shopping\n          </button>\n          <button className=\"selectButton\" onClick={this.clearCart}>\n            Clear Cart\n          </button>\n          <br />\n          <br />\n\n          {this.renderCards()}\n\n          <br />\n          \n        </section>\n      </React.Fragment>\n    );\n  }\n}\n\nclass Card extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      amountToBuy: 0,\n      isDelivery: false,\n    };\n\n    this.handleCheckboxChange=this.handleCheckboxChange.bind(this);\n  }\n\n  handleCheckboxChange(event) {\n    const checked = event.target.checked;\n    this.setState({\n      [event.target.name]: checked\n    });\n    this.props.updateItemInCart(this.props.id, checked);\n  }\n\n  render () {\n    return (\n      <div className=\"itemColumns\">\n        <div className=\"itemValues\" align=\"center\">\n          <p>Seller: {this.props.seller[0].name}</p>\n          <p>Name: {this.props.name}</p>\n          <p>Pickup: {this.props.pickup}</p>\n          <p>Delivery: ${this.props.delivery}</p>\n          <br />\n          <p>Amount to buy: {this.props.amountToBuy}</p>\n          <p>Total price: ${this.props.totalPriceForItem}</p>\n\n          <button className=\"itemButton\" onClick={() => {\n            this.props.removeFromCart(this.props.id);\n          }}>Remove from Cart</button>\n          <input type=\"checkbox\" id=\"delivery\" name=\"isDelivery\" checked={this.state.isDelivery} onChange={this.handleCheckboxChange} />\n          <label htmlFor=\"delivery\"> Delivery?</label>\n        </div>\n      </div>\n    );\n  }\n\n}"]},"metadata":{},"sourceType":"module"}