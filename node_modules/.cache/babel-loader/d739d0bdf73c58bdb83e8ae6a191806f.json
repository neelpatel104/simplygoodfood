{"ast":null,"code":"var _jsxFileName = \"/Users/neelpatel/Desktop/Classes/342/Project/frontend-react/src/components/pages/OrderHistory.js\";\nimport React from 'react';\nimport { Redirect } from \"react-router-dom\";\nimport '@fortawesome/fontawesome-free/css/all.min.css';\nimport 'bootstrap-css-only/css/bootstrap.min.css';\nimport './FoodItems.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default class OrderHistory extends React.Component {\n  constructor(props) {\n    super(props);\n    var user;\n\n    if (this.props.location.state === undefined) {\n      user = \"\";\n    } else {\n      user = this.props.location.state.user;\n    }\n\n    let token = document.cookie.split('; ').find(row => row.startsWith('token'));\n    token = token.split('=')[1];\n    this.state = {\n      user: user,\n      id: 0,\n      //All food items in the system\n      items: [],\n      //Orders of the buyer\n      orders: [],\n      message: \"\",\n      token: token,\n      logout: false,\n      shop: false\n    };\n    this.renderOrders = this.renderOrders.bind(this);\n    this.handleTextChange = this.handleTextChange.bind(this);\n    this.getFoodItemName = this.getFoodItemName.bind(this);\n    this.logOut = this.logOut.bind(this);\n    this.onShop = this.onShop.bind(this);\n  }\n\n  componentDidMount() {\n    this.getFoodItems();\n    this.getOrders();\n  }\n\n  async getFoodItems() {\n    await fetch('http://localhost:8080/foodItems', {\n      method: 'GET',\n      credentials: 'include',\n      headers: {\n        'authorization': `Bearer ${this.state.token}`\n      }\n    }).then(response => response.json()).then(responseJSON => {\n      let newItems = responseJSON;\n      this.setState({\n        items: newItems\n      });\n    }).catch(err => {// this.setState({ user: \"\" });\n      // Do nothing, will be redirected back to home page\n      // throw new Error(err)\n    });\n  }\n  /**\n   * Fetch the orders of the user and load them into state.orders\n   */\n\n\n  async getOrders() {\n    await fetch(`http://localhost:8080/orders/${this.state.user}`, {\n      method: 'GET',\n      credentials: 'include',\n      headers: {\n        'Authorization': `Bearer ${this.state.token}`\n      }\n    }).then(response => response.json()).then(responseJSON => {\n      if (responseJSON.length <= 0) {\n        this.setState({\n          message: \"No orders to show\"\n        });\n      }\n\n      this.setState({\n        orders: responseJSON\n      });\n      console.log(responseJSON);\n    }).catch(err => {\n      // Do nothing, will be redirected to home page\n      throw new Error(err);\n    });\n  }\n\n  handleTextChange(event) {\n    const value = event.target.value;\n    this.setState({\n      [event.target.name]: value\n    });\n  }\n\n  logOut() {\n    document.cookie = \"token=\";\n    this.setState({\n      user: \"\"\n    });\n  }\n\n  onShop() {\n    this.setState({\n      shop: true\n    });\n  }\n\n  getFoodItemName(id) {\n    var name = \"Missing\";\n\n    for (var i = 0; i < this.state.items.length; i++) {\n      if (this.state.items[i]._id === id) {\n        name = this.state.items[i].name;\n      }\n    }\n\n    return name;\n  }\n\n  renderOrders() {\n    if (this.state.orders.length <= 0) {\n      return /*#__PURE__*/_jsxDEV(\"h2\", {\n        children: this.state.message\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 9\n      }, this);\n    }\n\n    var orders = [];\n\n    for (let i = this.state.orders.length - 1; i >= 0; i--) {\n      var date = new Date(this.state.orders[i].date);\n      orders.push( /*#__PURE__*/_jsxDEV(Order, {\n        date: date.toLocaleString(),\n        totalPrice: this.state.orders[i].totalPrice.toFixed(2),\n        seller: this.state.orders[i].seller[0].name,\n        type: this.state.orders[i].type,\n        status: this.state.orders[i].status,\n        address: this.state.orders[i].address\n      }, i, false, {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 19\n      }, this));\n      let orderDetails = \"\";\n\n      for (let j = 0; j < this.state.orders[i].foodItems.length; j++) {\n        let name = this.getFoodItemName(this.state.orders[i].foodItems[j].foodItem);\n        orderDetails = this.state.orders[i].foodItems[j].quantity + \" \" + name + \", $\" + this.state.orders[i].foodItems[j].foodItemsPrice.toFixed(2);\n        orders.push( /*#__PURE__*/_jsxDEV(\"h4\", {\n          children: orderDetails\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 149,\n          columnNumber: 21\n        }, this));\n      }\n\n      orders.push( /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 19\n      }, this));\n      orders.push( /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 19\n      }, this));\n    }\n\n    return orders;\n  }\n\n  render() {\n    // If no user is logged in\n    if (this.state.user === \"\") {\n      return /*#__PURE__*/_jsxDEV(Redirect, {\n        to: \"/\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 161,\n        columnNumber: 11\n      }, this);\n    }\n\n    if (this.state.shop) {\n      return (\n        /*#__PURE__*/\n        //Redirect to orderHistory.js with the user and their cart\n        _jsxDEV(Redirect, {\n          to: {\n            pathname: '/Shop',\n            state: {\n              user: this.state.user,\n              cart: this.props.location.state.cart\n            }\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 168,\n          columnNumber: 9\n        }, this)\n      );\n    }\n\n    return /*#__PURE__*/_jsxDEV(React.Fragment, {\n      children: /*#__PURE__*/_jsxDEV(\"section\", {\n        className: \"content-container\",\n        children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n          className: \"pageheader\",\n          children: \"Order History\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 175,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"rows\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            style: {\n              float: 'right'\n            },\n            className: \"selectButton\",\n            onClick: this.logOut,\n            children: \"Log Out\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 177,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            style: {\n              float: 'right'\n            },\n            className: \"selectButton\",\n            onClick: this.onShop,\n            children: \"Shop\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 180,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 176,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 184,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 185,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 186,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 187,\n          columnNumber: 11\n        }, this), this.renderOrders(), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 190,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 174,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 173,\n      columnNumber: 7\n    }, this);\n  }\n\n}\n\nclass Order extends React.Component {\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: [\"Date: \", this.props.date]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n        children: [\"Total: $\", this.props.totalPrice, \", Seller: \", this.props.seller, \", Status: \", this.props.status]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 203,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h4\", {\n        children: [\"Type: \", this.props.type, \", Address: \", this.props.address]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 204,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 201,\n      columnNumber: 7\n    }, this);\n  }\n\n}","map":{"version":3,"sources":["/Users/neelpatel/Desktop/Classes/342/Project/frontend-react/src/components/pages/OrderHistory.js"],"names":["React","Redirect","OrderHistory","Component","constructor","props","user","location","state","undefined","token","document","cookie","split","find","row","startsWith","id","items","orders","message","logout","shop","renderOrders","bind","handleTextChange","getFoodItemName","logOut","onShop","componentDidMount","getFoodItems","getOrders","fetch","method","credentials","headers","then","response","json","responseJSON","newItems","setState","catch","err","length","console","log","Error","event","value","target","name","i","_id","date","Date","push","toLocaleString","totalPrice","toFixed","seller","type","status","address","orderDetails","j","foodItems","foodItem","quantity","foodItemsPrice","render","pathname","cart","float","Order"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Redirect } from \"react-router-dom\";\n\nimport '@fortawesome/fontawesome-free/css/all.min.css'; \nimport 'bootstrap-css-only/css/bootstrap.min.css'; \nimport './FoodItems.css';\n\nexport default class OrderHistory extends React.Component {\n  constructor(props) {\n    super(props);\n\n    var user;\n    if (this.props.location.state === undefined) {\n      user = \"\";\n    } else {\n      user = this.props.location.state.user;\n    }\n    \n    let token = document.cookie.split('; ').find(row => row.startsWith('token'));\n    token = token.split('=')[1];\n\n    this.state = {\n      user: user,\n      id: 0,\n      //All food items in the system\n      items: [],\n      //Orders of the buyer\n      orders: [],\n      message: \"\",\n      token: token,\n      logout: false,\n      shop: false,\n    };\n    this.renderOrders=this.renderOrders.bind(this);\n    this.handleTextChange=this.handleTextChange.bind(this);\n    this.getFoodItemName=this.getFoodItemName.bind(this);\n    this.logOut=this.logOut.bind(this);\n    this.onShop=this.onShop.bind(this);\n  }\n\n  componentDidMount() {\n    this.getFoodItems();\n    this.getOrders();\n  }\n\n  async getFoodItems(){\n    await fetch('http://localhost:8080/foodItems', {\n      method: 'GET',\n      credentials: 'include',\n      headers: {\n        'authorization': `Bearer ${this.state.token}`,\n      },\n    })\n    .then(response => response.json())\n    .then(responseJSON => {\n      let newItems = responseJSON;\n      \n      this.setState({items: newItems});\n    })\n    .catch(err => {\n      // this.setState({ user: \"\" });\n      // Do nothing, will be redirected back to home page\n      // throw new Error(err)\n    })\n  }\n\n  /**\n   * Fetch the orders of the user and load them into state.orders\n   */\n   async getOrders() {\n    await fetch(`http://localhost:8080/orders/${this.state.user}`, {\n      method: 'GET',\n      credentials: 'include',\n      headers: {\n        'Authorization': `Bearer ${this.state.token}`,\n      }\n    })\n    .then(response => response.json())\n    .then(responseJSON => {\n      if (responseJSON.length <= 0) {\n        this.setState({ message: \"No orders to show\" });\n      }\n\n      this.setState({ orders: responseJSON });\n      console.log(responseJSON);\n    })\n    .catch(err => {\n      // Do nothing, will be redirected to home page\n      throw new Error(err);\n    })\n  }\n\n  handleTextChange(event) {\n    const value = event.target.value;\n    this.setState({\n      [event.target.name]: value\n    });\n  }\n\n  logOut(){\n    document.cookie = \"token=\";\n    this.setState({user: \"\"});\n  }\n\n  onShop() {\n    this.setState({ shop: true });\n  }\n\n  getFoodItemName(id) {\n    var name = \"Missing\";\n\n    for(var i = 0; i < this.state.items.length; i++) {\n      if (this.state.items[i]._id === id) {\n        name = this.state.items[i].name;\n      }\n    }\n\n    return name;\n  }\n\n  renderOrders() {\n    if (this.state.orders.length <= 0) {\n      return (\n        <h2>{this.state.message}</h2>\n      );\n    }\n\n    var orders = [];\n    for(let i = this.state.orders.length - 1; i >= 0; i--) {\n      \n      var date = new Date(this.state.orders[i].date);\n\n      orders.push(<Order key={i}\n                    date={date.toLocaleString()}\n                    totalPrice={this.state.orders[i].totalPrice.toFixed(2)}\n                    seller={this.state.orders[i].seller[0].name}\n                    type={this.state.orders[i].type}\n                    status={this.state.orders[i].status}\n                    address={this.state.orders[i].address}\n                  />);\n\n      let orderDetails = \"\";\n      for(let j = 0; j < this.state.orders[i].foodItems.length; j++) {\n\n        let name = this.getFoodItemName(this.state.orders[i].foodItems[j].foodItem);\n\n        orderDetails = this.state.orders[i].foodItems[j].quantity + \" \" + name + \", $\" + this.state.orders[i].foodItems[j].foodItemsPrice.toFixed(2);\n        \n        orders.push(<h4>{orderDetails}</h4>);\n      }\n      orders.push(<br/>);\n      orders.push(<br/>);\n    }\n    return orders;\n  }\n\n  render() {\n    // If no user is logged in\n    if (this.state.user === \"\") {\n        return(\n          <Redirect to=\"/\" />\n        );\n    }\n\n    if (this.state.shop) {\n      return (\n        //Redirect to orderHistory.js with the user and their cart\n        <Redirect to={{ pathname: '/Shop', state: { user: this.state.user, cart: this.props.location.state.cart } }} />\n      );\n    }\n\n    return (\n      <React.Fragment>\n        <section className=\"content-container\">\n          <h1 className=\"pageheader\">Order History</h1>\n          <div className=\"rows\">\n            <button style={{ float: 'right'}} className=\"selectButton\" onClick={this.logOut}>\n            Log Out\n            </button>\n            <button style={{ float: 'right'}} className=\"selectButton\" onClick={this.onShop}>\n            Shop\n            </button>\n          </div>\n          <br />\n          <br />\n          <br />\n          <br />\n          {this.renderOrders()}\n          \n          <br />\n\n        </section>\n      </React.Fragment>\n    );\n  }\n}\n\nclass Order extends React.Component {\n  render () {\n    return (\n      <div>\n        <h2>Date: {this.props.date}</h2>\n        <h3>Total: ${this.props.totalPrice}, Seller: {this.props.seller}, Status: {this.props.status}</h3>\n        <h4>Type: {this.props.type}, Address: {this.props.address}</h4>\n      </div>\n    );\n  }\n}"]},"metadata":{},"sourceType":"module"}