{"ast":null,"code":"var _jsxFileName = \"/Users/neelpatel/Desktop/Classes/342/Project/frontend-react/src/components/pages/Checkout.js\";\nimport React from 'react';\nimport { Redirect } from \"react-router-dom\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default class Checkout extends React.Component {\n  constructor(props) {\n    super(props);\n    let token = document.cookie.split('; ').find(row => row.startsWith('token'));\n    token = token.split('=')[1];\n    var user;\n    let cart = [];\n\n    if (this.props.location.state === undefined) {\n      user = \"\";\n    } else {\n      user = this.props.location.state.user;\n      cart = this.props.location.state.cart;\n    } // Initialize totalPriceForItem for each item to 0, this will be updated when Checkout is mounted\n\n\n    for (let i = 0; i < cart.length; i++) {\n      for (let j = 0; j < cart[i].length; j++) {\n        cart[i][j].totalPriceForItem = 0;\n\n        if (cart[i][j].delivery === undefined) {\n          cart[i][j].delivery = false;\n        }\n      }\n    }\n\n    this.state = {\n      user: user,\n      items: cart,\n      total: 0,\n      token: token,\n      shop: false,\n      payment: false\n    };\n    this.onShop = this.onShop.bind(this);\n    this.clearCart = this.clearCart.bind(this);\n    this.calculateTotal = this.calculateTotal.bind(this);\n    this.updateItemInCart = this.updateItemInCart.bind(this);\n    this.removeFromCart = this.removeFromCart.bind(this);\n    this.purchase = this.purchase.bind(this);\n    this.logOut = this.logOut.bind(this);\n  } // Runs as soon as Checkout mounts\n  // Not in constructor to avoid warning\n\n\n  componentDidMount() {\n    this.calculateTotal();\n  }\n\n  calculateTotal() {\n    let newItems = this.state.items;\n    let totalPrice = 0;\n\n    for (let i = 0; i < newItems.length; i++) {\n      let maxDeliveryFee = 0;\n\n      for (let j = 0; j < newItems[i].length; j++) {\n        // Calculate total price for item\n        newItems[i][j].totalPriceForItem = +newItems[i][j].price * +newItems[i][j].amountToBuy;\n\n        if (newItems[i][j].delivery && newItems[i][j].deliveryFee > maxDeliveryFee) {\n          // newItems[i][j].totalPriceForItem = +newItems[i][j].totalPriceForItem + +newItems[i][j].deliveryFee;\n          maxDeliveryFee = newItems[i][j].deliveryFee;\n        } // Update total price for transaction\n\n\n        totalPrice += newItems[i][j].totalPriceForItem; // Rounding\n\n        newItems[i][j].totalPriceForItem = Math.round(newItems[i][j].totalPriceForItem * 100) / 100;\n      }\n\n      totalPrice = +totalPrice + +maxDeliveryFee;\n      totalPrice = Math.round(totalPrice * 100) / 100; // Store max delivery fee of order with the first item\n\n      newItems[i][0].maxDeliveryFee = maxDeliveryFee;\n    }\n\n    this.setState({\n      total: totalPrice\n    });\n  }\n\n  onShop() {\n    this.setState({\n      shop: true\n    });\n  }\n\n  clearCart() {\n    this.setState({\n      items: []\n    });\n    this.setState({\n      total: 0\n    });\n  }\n\n  updateItemInCart(idx, isDelivery) {\n    let sellerIdx = idx[0];\n    let newItems = this.state.items;\n\n    for (let i = 0; i < newItems[sellerIdx].length; i++) {\n      newItems[sellerIdx][i].delivery = isDelivery;\n    }\n\n    this.setState({\n      items: newItems\n    });\n    this.calculateTotal();\n  }\n\n  removeFromCart(idx) {\n    let sellerIdx = idx[0];\n    let itemIdx = idx[1];\n    let newItems = this.state.items;\n    newItems[sellerIdx].splice(itemIdx, 1); // If item was the last one in the seller array, delete the (now empty) seller array from the cart\n\n    if (newItems[sellerIdx].length === 0) {\n      newItems.splice(sellerIdx, 1);\n    }\n\n    this.setState({\n      items: newItems\n    });\n    this.calculateTotal();\n  }\n\n  purchase() {\n    if (this.state.total > 0) {\n      this.setState({\n        payment: true\n      });\n    }\n  }\n\n  logOut() {\n    document.cookie = \"token=\";\n    this.setState({\n      user: \"\"\n    });\n  }\n\n  renderCards() {\n    var cards = [];\n\n    for (let i = 0; i < this.state.items.length; i++) {\n      for (let j = 0; j < this.state.items[i].length; j++) {\n        cards.push( /*#__PURE__*/_jsxDEV(Card, {\n          id: [i, j],\n          seller: this.state.items[i][j].seller,\n          name: this.state.items[i][j].name,\n          totalPriceForItem: this.state.items[i][j].totalPriceForItem,\n          amountToBuy: this.state.items[i][j].amountToBuy,\n          pickup: this.state.items[i][j].pickup,\n          deliveryFee: this.state.items[i][j].deliveryFee,\n          delivery: this.state.items[i][j].delivery,\n          updateItemInCart: this.updateItemInCart,\n          removeFromCart: this.removeFromCart\n        }, [i, j], false, {\n          fileName: _jsxFileName,\n          lineNumber: 135,\n          columnNumber: 20\n        }, this));\n      }\n    }\n\n    return cards;\n  }\n\n  render() {\n    if (this.state.user === \"\") {\n      return /*#__PURE__*/_jsxDEV(Redirect, {\n        to: \"/\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 11\n      }, this);\n    }\n\n    if (this.state.shop) {\n      return /*#__PURE__*/_jsxDEV(Redirect, {\n        to: {\n          pathname: '/Shop',\n          state: {\n            user: this.state.user,\n            cart: this.state.items\n          }\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 163,\n        columnNumber: 9\n      }, this);\n    }\n\n    if (this.state.payment) {\n      return /*#__PURE__*/_jsxDEV(Redirect, {\n        to: {\n          pathname: '/Payment',\n          state: {\n            user: this.state.user,\n            cart: this.state.items,\n            total: this.state.total\n          }\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 169,\n        columnNumber: 9\n      }, this);\n    }\n\n    return /*#__PURE__*/_jsxDEV(React.Fragment, {\n      children: /*#__PURE__*/_jsxDEV(\"section\", {\n        className: \"content-container\",\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          className: \"pageheader\",\n          children: [\"Total: $\", this.state.total.toFixed(2)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 177,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"selectButton\",\n          onClick: this.purchase,\n          children: \"Purchase\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 178,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"selectButton\",\n          onClick: this.onShop,\n          children: \"Return to shopping\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 181,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"selectButton\",\n          onClick: this.clearCart,\n          children: \"Clear Cart\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 184,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          style: {\n            float: 'right'\n          },\n          className: \"selectButton\",\n          onClick: this.logOut,\n          children: \"Log Out\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 187,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 190,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 191,\n          columnNumber: 11\n        }, this), this.renderCards(), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 197,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 175,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 174,\n      columnNumber: 7\n    }, this);\n  }\n\n}\n\nclass Card extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      amountToBuy: 0\n    };\n    this.handleCheckboxChange = this.handleCheckboxChange.bind(this);\n  }\n\n  handleCheckboxChange(event) {\n    const checked = event.target.checked;\n    this.setState({\n      [event.target.name]: checked\n    });\n    this.props.updateItemInCart(this.props.id, checked);\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"itemColumns\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"itemValues\",\n        align: \"center\",\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"Seller: \", this.props.seller[0].name]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 229,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"Name: \", this.props.name]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 230,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"Pickup: \", this.props.pickup]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 231,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"Delivery: $\", this.props.deliveryFee]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 232,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 233,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"Amount to buy: \", this.props.amountToBuy]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 234,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"Total price: $\", this.props.totalPriceForItem.toFixed(2)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 235,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"itemButton\",\n          onClick: () => {\n            this.props.removeFromCart(this.props.id);\n          },\n          children: \"Remove from Cart\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 237,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"checkbox\",\n          id: \"delivery\",\n          name: \"isDelivery\",\n          checked: this.props.delivery,\n          onChange: this.handleCheckboxChange\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 240,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          htmlFor: \"delivery\",\n          children: \" Delivery?\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 241,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 228,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 227,\n      columnNumber: 7\n    }, this);\n  }\n\n}","map":{"version":3,"sources":["/Users/neelpatel/Desktop/Classes/342/Project/frontend-react/src/components/pages/Checkout.js"],"names":["React","Redirect","Checkout","Component","constructor","props","token","document","cookie","split","find","row","startsWith","user","cart","location","state","undefined","i","length","j","totalPriceForItem","delivery","items","total","shop","payment","onShop","bind","clearCart","calculateTotal","updateItemInCart","removeFromCart","purchase","logOut","componentDidMount","newItems","totalPrice","maxDeliveryFee","price","amountToBuy","deliveryFee","Math","round","setState","idx","isDelivery","sellerIdx","itemIdx","splice","renderCards","cards","push","seller","name","pickup","render","pathname","toFixed","float","Card","handleCheckboxChange","event","checked","target","id"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Redirect } from \"react-router-dom\";\n\nexport default class Checkout extends React.Component {\n  constructor(props) {\n    super(props);\n    \n    let token = document.cookie.split('; ').find(row => row.startsWith('token'));\n    token = token.split('=')[1];\n    \n    var user;\n    let cart = [];\n    if (this.props.location.state === undefined) {\n      user = \"\";\n    } else {\n      user = this.props.location.state.user;\n      cart = this.props.location.state.cart;\n    }\n\n    // Initialize totalPriceForItem for each item to 0, this will be updated when Checkout is mounted\n    for (let i = 0; i < cart.length; i++) {\n      for (let j = 0; j < cart[i].length; j++) {\n        cart[i][j].totalPriceForItem = 0;\n        if (cart[i][j].delivery === undefined) {\n          cart[i][j].delivery = false;\n        }\n      }\n    }\n\n    this.state = {\n      user: user,\n      items: cart,\n      total: 0,\n      token: token,\n      shop: false,\n      payment: false,\n    };\n\n    this.onShop=this.onShop.bind(this);\n    this.clearCart=this.clearCart.bind(this);\n    this.calculateTotal=this.calculateTotal.bind(this);\n    this.updateItemInCart=this.updateItemInCart.bind(this);\n    this.removeFromCart=this.removeFromCart.bind(this);\n    this.purchase=this.purchase.bind(this);\n    this.logOut=this.logOut.bind(this);\n  }\n\n  // Runs as soon as Checkout mounts\n  // Not in constructor to avoid warning\n  componentDidMount() {\n    this.calculateTotal();\n  }\n\n  calculateTotal() {\n    let newItems = this.state.items;\n    let totalPrice = 0;\n    \n    for (let i = 0; i < newItems.length; i++) {\n      \n      let maxDeliveryFee = 0;\n      for (let j = 0; j < newItems[i].length; j++) {\n        // Calculate total price for item\n        newItems[i][j].totalPriceForItem = +newItems[i][j].price * +newItems[i][j].amountToBuy;\n        if (newItems[i][j].delivery && newItems[i][j].deliveryFee > maxDeliveryFee) {\n          // newItems[i][j].totalPriceForItem = +newItems[i][j].totalPriceForItem + +newItems[i][j].deliveryFee;\n          maxDeliveryFee = newItems[i][j].deliveryFee;\n        }\n        // Update total price for transaction\n        totalPrice += newItems[i][j].totalPriceForItem;\n        // Rounding\n        newItems[i][j].totalPriceForItem = Math.round(newItems[i][j].totalPriceForItem * 100) / 100;\n      }\n      totalPrice = +totalPrice + +maxDeliveryFee;\n      totalPrice = Math.round(totalPrice * 100) / 100;\n\n      // Store max delivery fee of order with the first item\n      newItems[i][0].maxDeliveryFee = maxDeliveryFee;\n    }\n\n    this.setState({ total: totalPrice });\n  }\n\n  onShop() {\n    this.setState({ shop: true });\n  }\n\n  clearCart() {\n    this.setState({ items: [] });\n    this.setState({ total: 0 });\n  }\n\n  updateItemInCart(idx, isDelivery) {\n    let sellerIdx = idx[0];\n\n    let newItems = this.state.items;\n    for (let i = 0; i < newItems[sellerIdx].length; i++) {\n      newItems[sellerIdx][i].delivery = isDelivery;\n    }\n\n    this.setState( {items: newItems });\n    this.calculateTotal();\n  }\n\n  removeFromCart(idx) {\n    let sellerIdx = idx[0];\n    let itemIdx = idx[1];\n    let newItems = this.state.items;\n\n    newItems[sellerIdx].splice(itemIdx, 1);\n\n    // If item was the last one in the seller array, delete the (now empty) seller array from the cart\n    if (newItems[sellerIdx].length === 0) {\n      newItems.splice(sellerIdx, 1);\n    }\n\n    this.setState( {items: newItems });\n    this.calculateTotal();\n  }\n\n  purchase() {\n    if (this.state.total > 0) {\n      this.setState({ payment: true });\n    }\n  }\n\n  logOut(){\n    document.cookie = \"token=\";\n    this.setState({user: \"\"});\n  }\n\n  renderCards() {\n    var cards = [];\n    for (let i = 0; i < this.state.items.length; i++) {\n      for (let j = 0; j < this.state.items[i].length; j++) {\n        cards.push(<Card\n                key={[i, j]}\n                id={[i, j]}\n                seller={this.state.items[i][j].seller}\n                name={this.state.items[i][j].name}\n                totalPriceForItem={this.state.items[i][j].totalPriceForItem}\n                amountToBuy={this.state.items[i][j].amountToBuy}\n                pickup={this.state.items[i][j].pickup}\n                deliveryFee={this.state.items[i][j].deliveryFee}\n                delivery={this.state.items[i][j].delivery}\n                updateItemInCart={this.updateItemInCart}\n                removeFromCart={this.removeFromCart}\n              />);\n      }\n    }\n    return cards;\n  }\n\n  render() {\n\n    if (this.state.user === \"\") {\n        return(\n          <Redirect to=\"/\" />\n        );\n    }\n\n    if (this.state.shop) {\n      return (\n        <Redirect to={{ pathname: '/Shop', state: { user: this.state.user, cart: this.state.items } }} />\n      );\n    }\n\n    if (this.state.payment) {\n      return (\n        <Redirect to={{ pathname: '/Payment', state: { user: this.state.user, cart: this.state.items, total: this.state.total } }} />\n      );\n    }\n\n    return (\n      <React.Fragment>\n        <section className=\"content-container\">\n          \n          <h2 className=\"pageheader\">Total: ${this.state.total.toFixed(2)}</h2>\n          <button className=\"selectButton\" onClick={this.purchase}>\n            Purchase\n          </button>\n          <button className=\"selectButton\" onClick={this.onShop}>\n            Return to shopping\n          </button>\n          <button className=\"selectButton\" onClick={this.clearCart}>\n            Clear Cart\n          </button>\n          <button style={{ float: 'right'}} className=\"selectButton\" onClick={this.logOut}>\n            Log Out\n            </button>\n          <br />\n          <br />\n\n          \n\n          {this.renderCards()}\n\n          <br />\n\n          \n        </section>\n      </React.Fragment>\n    );\n  }\n}\n\nclass Card extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      amountToBuy: 0,\n    };\n\n    this.handleCheckboxChange=this.handleCheckboxChange.bind(this);\n  }\n\n  handleCheckboxChange(event) {\n    const checked = event.target.checked;\n    this.setState({\n      [event.target.name]: checked\n    });\n    this.props.updateItemInCart(this.props.id, checked);\n  }\n\n  render () {\n    return (\n      <div className=\"itemColumns\">\n        <div className=\"itemValues\" align=\"center\">\n          <p>Seller: {this.props.seller[0].name}</p>\n          <p>Name: {this.props.name}</p>\n          <p>Pickup: {this.props.pickup}</p>\n          <p>Delivery: ${this.props.deliveryFee}</p>\n          <br />\n          <p>Amount to buy: {this.props.amountToBuy}</p>\n          <p>Total price: ${this.props.totalPriceForItem.toFixed(2)}</p>\n\n          <button className=\"itemButton\" onClick={() => {\n            this.props.removeFromCart(this.props.id);\n          }}>Remove from Cart</button>\n          <input type=\"checkbox\" id=\"delivery\" name=\"isDelivery\" checked={this.props.delivery} onChange={this.handleCheckboxChange} />\n          <label htmlFor=\"delivery\"> Delivery?</label>\n        </div>\n      </div>\n    );\n  }\n\n}"]},"metadata":{},"sourceType":"module"}