{"ast":null,"code":"var _jsxFileName = \"/Users/neelpatel/Desktop/Classes/342/Project/frontend-react/src/components/pages/Shop.js\";\nimport React from 'react';\nimport { Redirect } from \"react-router-dom\";\nimport '@fortawesome/fontawesome-free/css/all.min.css';\nimport 'bootstrap-css-only/css/bootstrap.min.css';\nimport './FoodItems.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default class Shop extends React.Component {\n  constructor(props) {\n    super(props);\n    var user;\n    let cart = [];\n\n    if (this.props.location.state === undefined) {\n      user = \"\";\n    } else {\n      user = this.props.location.state.user;\n      cart = this.props.location.state.cart;\n    }\n\n    let token = document.cookie.split('; ').find(row => row.startsWith('token'));\n\n    if (token === undefined) {\n      user = \"\";\n    }\n\n    token = token.split('=')[1];\n    this.state = {\n      user: user,\n      id: 0,\n      //All food items for sale\n      items: [],\n      //Food items in buyer's cart - passed to checkout.js and back\n      cart: cart,\n      newSeller: \"\",\n      newName: \"\",\n      newPrice: \"\",\n      newAmount: \"\",\n      newPickup: \"\",\n      newDelivery: \"\",\n      token: token,\n      message: \"\",\n      checkout: false,\n      logout: false,\n      orderHistory: false\n    };\n    this.handleTextChange = this.handleTextChange.bind(this);\n    this.addToCart = this.addToCart.bind(this);\n    this.onCheckout = this.onCheckout.bind(this);\n    this.logOut = this.logOut.bind(this);\n    this.onOrderHistory = this.onOrderHistory.bind(this);\n  }\n\n  componentDidMount() {\n    this.getFoodItems();\n  }\n\n  async getFoodItems() {\n    await fetch('http://localhost:8080/foodItems', {\n      method: 'GET',\n      credentials: 'include',\n      headers: {\n        'authorization': `Bearer ${this.state.token}`\n      }\n    }).then(response => response.json()).then(responseJSON => {\n      if (responseJSON.length <= 0) {\n        this.setState({\n          message: \"No items in the shop, sorry!\"\n        });\n      }\n\n      let newItems = responseJSON;\n      let newCart = this.state.cart;\n\n      for (let i = 0; i < newItems.length; i++) {\n        newItems[i].amountToBuy = 0; // Check if seller exists in cart\n\n        for (let j = 0; j < newCart.length; j++) {\n          // If yes, loop through the array of items corresponding to the seller in the cart\n          if (newItems[i].seller[0].name === newCart[j][0].seller[0].name) {\n            // Check if item exists in cart\n            for (let k = 0; k < newCart[j].length; k++) {\n              // If yes\n              if (newItems[i].name === newCart[j][k].name) {\n                // Update the amount to buy and quantity of the displayed item to match the corresponding item in the cart\n                newItems[i].amountToBuy = newCart[j][k].amountToBuy;\n                newItems[i].quantity = +newItems[i].quantity - +newItems[i].amountToBuy;\n              }\n            }\n          }\n        }\n      } // Do not display items that have a quantity of 0\n\n\n      for (let i = newItems.length - 1; i >= 0; i--) {\n        if (newItems[i].quantity <= 0) {\n          newItems.splice(i, 1);\n        }\n      }\n\n      this.setState({\n        items: newItems\n      });\n    }).catch(err => {// this.setState({ user: \"\" });\n      // Do nothing, will be redirected back to home page\n      // throw new Error(err)\n    });\n  }\n\n  async deleteFood(name) {\n    await fetch(`http://localhost:8080/foodItems/${name}`, {\n      method: 'DELETE',\n      credentials: 'include',\n      headers: {\n        'Authorization': `Bearer ${this.state.token}`\n      }\n    }).then(() => this.getFoodItems()).catch(err => {\n      throw new Error(err);\n    });\n  }\n\n  handleTextChange(event) {\n    const value = event.target.value;\n    this.setState({\n      [event.target.name]: value\n    });\n  }\n\n  discard(seller, name) {\n    this.deleteFood(seller, name);\n  }\n\n  addToCart(idx, amountToBuy, isDelivery) {\n    // Error checking, cannot buy amount of 0\n    if (amountToBuy <= 0) {\n      return;\n    } // Update displayed item\n\n\n    var newItems = this.state.items;\n    newItems[idx].amountToBuy = +newItems[idx].amountToBuy + +amountToBuy;\n    newItems[idx].quantity = +newItems[idx].quantity - +amountToBuy;\n    newItems[idx].isDelivery = isDelivery;\n    this.setState({\n      items: newItems\n    }); // Update cart\n\n    let newCart = this.state.cart;\n    var sellerInCart = false;\n    var itemInCart = false; // Find array corresponding to the correct seller\n    // The cart is a 2d array structured as an array of arrays of items corresponding to each seller\n    // [sellers][items]\n\n    for (let i = 0; i < newCart.length; i++) {\n      // Found array corresponding to correct seller\n      if (newItems[idx].seller[0].name === newCart[i][0].seller[0].name) {\n        sellerInCart = true; // Find item\n\n        for (let j = 0; j < newCart[i].length; j++) {\n          // Found item\n          if (newItems[idx].name === newCart[i][j].name) {\n            itemInCart = true;\n            newCart[i][j].amountToBuy = newItems[idx].amountToBuy;\n          }\n        } // If item not found, add it to cart\n\n\n        if (!itemInCart) {\n          newCart[i].push(newItems[idx]);\n        }\n      }\n    } // If correct seller array not found, add the item to a new array in the cart\n\n\n    if (!sellerInCart) {\n      newCart.push([]);\n      newCart[newCart.length - 1].push(newItems[idx]);\n    }\n\n    this.setState({\n      cart: newCart\n    });\n  }\n\n  logOut() {\n    document.cookie = \"token=\";\n    this.setState({\n      user: \"\"\n    });\n  }\n\n  onOrderHistory() {\n    this.setState({\n      orderHistory: true\n    });\n  }\n\n  onCheckout() {\n    this.setState({\n      checkout: true\n    });\n  }\n\n  renderCards() {\n    if (this.state.items.length <= 0) {\n      return /*#__PURE__*/_jsxDEV(\"h2\", {\n        children: this.state.message\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 195,\n        columnNumber: 9\n      }, this);\n    }\n\n    var cards = [];\n\n    for (let i = 0; i < this.state.items.length; i++) {\n      cards.push( /*#__PURE__*/_jsxDEV(Card, {\n        id: i,\n        seller: this.state.items[i].seller[0].name,\n        name: this.state.items[i].name,\n        price: this.state.items[i].price,\n        amount: this.state.items[i].quantity,\n        pickup: this.state.items[i].seller[0].address,\n        delivery: this.state.items[i].deliveryFee,\n        addToCart: this.addToCart\n      }, i, false, {\n        fileName: _jsxFileName,\n        lineNumber: 200,\n        columnNumber: 18\n      }, this));\n    }\n\n    return cards;\n  }\n\n  render() {\n    // If no user is logged in\n    if (this.state.user === \"\") {\n      return /*#__PURE__*/_jsxDEV(Redirect, {\n        to: \"/\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 219,\n        columnNumber: 11\n      }, this);\n    }\n\n    if (this.state.checkout) {\n      return (\n        /*#__PURE__*/\n        //Redirect to checkout.js with the user and their cart\n        _jsxDEV(Redirect, {\n          to: {\n            pathname: '/Checkout',\n            state: {\n              user: this.state.user,\n              cart: this.state.cart\n            }\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 226,\n          columnNumber: 9\n        }, this)\n      );\n    }\n\n    if (this.state.orderHistory) {\n      return (\n        /*#__PURE__*/\n        //Redirect to orderHistory.js with the user and their cart\n        _jsxDEV(Redirect, {\n          to: {\n            pathname: '/OrderHistory',\n            state: {\n              user: this.state.user,\n              cart: this.state.cart\n            }\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 233,\n          columnNumber: 9\n        }, this)\n      );\n    }\n\n    return /*#__PURE__*/_jsxDEV(React.Fragment, {\n      children: /*#__PURE__*/_jsxDEV(\"section\", {\n        className: \"content-container\",\n        children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n          className: \"pageheader\",\n          children: \"Shop\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 240,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"rows\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            align: \"right\",\n            className: \"selectButton\",\n            onClick: this.onCheckout,\n            children: \"View Cart\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 242,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            style: {\n              float: 'right'\n            },\n            className: \"selectButton\",\n            onClick: this.logOut,\n            children: \"Log Out\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 245,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            style: {\n              float: 'right'\n            },\n            className: \"selectButton\",\n            onClick: this.onOrderHistory,\n            children: \"Order History\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 248,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 241,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 252,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 253,\n          columnNumber: 11\n        }, this), this.renderCards(), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 256,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 239,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 238,\n      columnNumber: 7\n    }, this);\n  }\n\n}\n\nclass Card extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      amountToBuy: 0,\n      isDelivery: false\n    };\n    this.handleTextChange = this.handleTextChange.bind(this);\n  }\n\n  handleTextChange(event) {\n    let value = event.target.value;\n\n    if (value > this.props.amount) {\n      value = this.props.amount;\n    } else if (value < 0) {\n      value = 0;\n    }\n\n    this.setState({\n      [event.target.name]: value\n    });\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"itemColumns\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"itemValues\",\n        align: \"center\",\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"Seller: \", this.props.seller]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 290,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"Name: \", this.props.name]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 291,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"Price: $\", this.props.price]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 292,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"Amount: \", this.props.amount]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 293,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"Pickup: \", this.props.pickup]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 294,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"Delivery: $\", this.props.delivery]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 295,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"itemButton\",\n          onClick: () => {\n            this.props.addToCart(this.props.id, this.state.amountToBuy, this.state.isDelivery);\n            this.setState({\n              amountToBuy: 0\n            });\n          },\n          children: \"Add to Cart\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 297,\n          columnNumber: 11\n        }, this), \"Amount: \", /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"number\",\n          className: \"amountInput\",\n          name: \"amountToBuy\",\n          min: \"0\",\n          max: this.props.amount,\n          value: this.state.amountToBuy,\n          onChange: this.handleTextChange\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 301,\n          columnNumber: 19\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 289,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 288,\n      columnNumber: 7\n    }, this);\n  }\n\n}","map":{"version":3,"sources":["/Users/neelpatel/Desktop/Classes/342/Project/frontend-react/src/components/pages/Shop.js"],"names":["React","Redirect","Shop","Component","constructor","props","user","cart","location","state","undefined","token","document","cookie","split","find","row","startsWith","id","items","newSeller","newName","newPrice","newAmount","newPickup","newDelivery","message","checkout","logout","orderHistory","handleTextChange","bind","addToCart","onCheckout","logOut","onOrderHistory","componentDidMount","getFoodItems","fetch","method","credentials","headers","then","response","json","responseJSON","length","setState","newItems","newCart","i","amountToBuy","j","seller","name","k","quantity","splice","catch","err","deleteFood","Error","event","value","target","discard","idx","isDelivery","sellerInCart","itemInCart","push","renderCards","cards","price","address","deliveryFee","render","pathname","float","Card","amount","pickup","delivery"],"mappings":";AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAASC,QAAT,QAAyB,kBAAzB;AAEA,OAAO,+CAAP;AACA,OAAO,0CAAP;AACA,OAAO,iBAAP;;AAEA,eAAe,MAAMC,IAAN,SAAmBF,KAAK,CAACG,SAAzB,CAAmC;AAChDC,EAAAA,WAAW,CAACC,KAAD,EAAQ;AACjB,UAAMA,KAAN;AAEA,QAAIC,IAAJ;AACA,QAAIC,IAAI,GAAG,EAAX;;AACA,QAAI,KAAKF,KAAL,CAAWG,QAAX,CAAoBC,KAApB,KAA8BC,SAAlC,EAA6C;AAC3CJ,MAAAA,IAAI,GAAG,EAAP;AACD,KAFD,MAEO;AACLA,MAAAA,IAAI,GAAG,KAAKD,KAAL,CAAWG,QAAX,CAAoBC,KAApB,CAA0BH,IAAjC;AACAC,MAAAA,IAAI,GAAG,KAAKF,KAAL,CAAWG,QAAX,CAAoBC,KAApB,CAA0BF,IAAjC;AACD;;AAED,QAAII,KAAK,GAAGC,QAAQ,CAACC,MAAT,CAAgBC,KAAhB,CAAsB,IAAtB,EAA4BC,IAA5B,CAAiCC,GAAG,IAAIA,GAAG,CAACC,UAAJ,CAAe,OAAf,CAAxC,CAAZ;;AACA,QAAIN,KAAK,KAAKD,SAAd,EAAyB;AACvBJ,MAAAA,IAAI,GAAG,EAAP;AACD;;AACDK,IAAAA,KAAK,GAAGA,KAAK,CAACG,KAAN,CAAY,GAAZ,EAAiB,CAAjB,CAAR;AAEA,SAAKL,KAAL,GAAa;AACXH,MAAAA,IAAI,EAAEA,IADK;AAEXY,MAAAA,EAAE,EAAE,CAFO;AAGX;AACAC,MAAAA,KAAK,EAAE,EAJI;AAKX;AACAZ,MAAAA,IAAI,EAAEA,IANK;AAOXa,MAAAA,SAAS,EAAE,EAPA;AAQXC,MAAAA,OAAO,EAAE,EARE;AASXC,MAAAA,QAAQ,EAAE,EATC;AAUXC,MAAAA,SAAS,EAAE,EAVA;AAWXC,MAAAA,SAAS,EAAE,EAXA;AAYXC,MAAAA,WAAW,EAAE,EAZF;AAaXd,MAAAA,KAAK,EAAEA,KAbI;AAcXe,MAAAA,OAAO,EAAE,EAdE;AAeXC,MAAAA,QAAQ,EAAE,KAfC;AAgBXC,MAAAA,MAAM,EAAE,KAhBG;AAiBXC,MAAAA,YAAY,EAAE;AAjBH,KAAb;AAmBA,SAAKC,gBAAL,GAAsB,KAAKA,gBAAL,CAAsBC,IAAtB,CAA2B,IAA3B,CAAtB;AACA,SAAKC,SAAL,GAAe,KAAKA,SAAL,CAAeD,IAAf,CAAoB,IAApB,CAAf;AACA,SAAKE,UAAL,GAAgB,KAAKA,UAAL,CAAgBF,IAAhB,CAAqB,IAArB,CAAhB;AACA,SAAKG,MAAL,GAAY,KAAKA,MAAL,CAAYH,IAAZ,CAAiB,IAAjB,CAAZ;AACA,SAAKI,cAAL,GAAoB,KAAKA,cAAL,CAAoBJ,IAApB,CAAyB,IAAzB,CAApB;AACD;;AAEDK,EAAAA,iBAAiB,GAAG;AAClB,SAAKC,YAAL;AACD;;AAEiB,QAAZA,YAAY,GAAE;AAClB,UAAMC,KAAK,CAAC,iCAAD,EAAoC;AAC7CC,MAAAA,MAAM,EAAE,KADqC;AAE7CC,MAAAA,WAAW,EAAE,SAFgC;AAG7CC,MAAAA,OAAO,EAAE;AACP,yBAAkB,UAAS,KAAKhC,KAAL,CAAWE,KAAM;AADrC;AAHoC,KAApC,CAAL,CAOL+B,IAPK,CAOAC,QAAQ,IAAIA,QAAQ,CAACC,IAAT,EAPZ,EAQLF,IARK,CAQAG,YAAY,IAAI;AACpB,UAAIA,YAAY,CAACC,MAAb,IAAuB,CAA3B,EAA8B;AAC5B,aAAKC,QAAL,CAAc;AAAErB,UAAAA,OAAO,EAAE;AAAX,SAAd;AACD;;AAED,UAAIsB,QAAQ,GAAGH,YAAf;AACA,UAAII,OAAO,GAAG,KAAKxC,KAAL,CAAWF,IAAzB;;AACA,WAAK,IAAI2C,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,QAAQ,CAACF,MAA7B,EAAqCI,CAAC,EAAtC,EAA0C;AACxCF,QAAAA,QAAQ,CAACE,CAAD,CAAR,CAAYC,WAAZ,GAA0B,CAA1B,CADwC,CAExC;;AACA,aAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGH,OAAO,CAACH,MAA5B,EAAoCM,CAAC,EAArC,EAAyC;AACvC;AACA,cAAIJ,QAAQ,CAACE,CAAD,CAAR,CAAYG,MAAZ,CAAmB,CAAnB,EAAsBC,IAAtB,KAA+BL,OAAO,CAACG,CAAD,CAAP,CAAW,CAAX,EAAcC,MAAd,CAAqB,CAArB,EAAwBC,IAA3D,EAAiE;AAC/D;AACA,iBAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGN,OAAO,CAACG,CAAD,CAAP,CAAWN,MAA/B,EAAuCS,CAAC,EAAxC,EAA4C;AAC1C;AACA,kBAAIP,QAAQ,CAACE,CAAD,CAAR,CAAYI,IAAZ,KAAqBL,OAAO,CAACG,CAAD,CAAP,CAAWG,CAAX,EAAcD,IAAvC,EAA6C;AAC3C;AACAN,gBAAAA,QAAQ,CAACE,CAAD,CAAR,CAAYC,WAAZ,GAA0BF,OAAO,CAACG,CAAD,CAAP,CAAWG,CAAX,EAAcJ,WAAxC;AACAH,gBAAAA,QAAQ,CAACE,CAAD,CAAR,CAAYM,QAAZ,GAAuB,CAACR,QAAQ,CAACE,CAAD,CAAR,CAAYM,QAAb,GAAwB,CAACR,QAAQ,CAACE,CAAD,CAAR,CAAYC,WAA5D;AACD;AACF;AACF;AACF;AACF,OAxBmB,CA0BpB;;;AACA,WAAK,IAAID,CAAC,GAAGF,QAAQ,CAACF,MAAT,GAAkB,CAA/B,EAAkCI,CAAC,IAAI,CAAvC,EAA0CA,CAAC,EAA3C,EAA+C;AAC7C,YAAIF,QAAQ,CAACE,CAAD,CAAR,CAAYM,QAAZ,IAAwB,CAA5B,EAA+B;AAC7BR,UAAAA,QAAQ,CAACS,MAAT,CAAgBP,CAAhB,EAAmB,CAAnB;AACD;AACF;;AAED,WAAKH,QAAL,CAAc;AAAC5B,QAAAA,KAAK,EAAE6B;AAAR,OAAd;AACD,KA1CK,EA2CLU,KA3CK,CA2CCC,GAAG,IAAI,CACZ;AACA;AACA;AACD,KA/CK,CAAN;AAgDD;;AAEe,QAAVC,UAAU,CAACN,IAAD,EAAO;AACrB,UAAMhB,KAAK,CAAE,mCAAkCgB,IAAK,EAAzC,EAA4C;AACrDf,MAAAA,MAAM,EAAE,QAD6C;AAErDC,MAAAA,WAAW,EAAE,SAFwC;AAGrDC,MAAAA,OAAO,EAAE;AACP,yBAAkB,UAAS,KAAKhC,KAAL,CAAWE,KAAM;AADrC;AAH4C,KAA5C,CAAL,CAOL+B,IAPK,CAOA,MAAM,KAAKL,YAAL,EAPN,EAQLqB,KARK,CAQCC,GAAG,IAAI;AACZ,YAAM,IAAIE,KAAJ,CAAUF,GAAV,CAAN;AACD,KAVK,CAAN;AAWD;;AAED7B,EAAAA,gBAAgB,CAACgC,KAAD,EAAQ;AACtB,UAAMC,KAAK,GAAGD,KAAK,CAACE,MAAN,CAAaD,KAA3B;AACA,SAAKhB,QAAL,CAAc;AACZ,OAACe,KAAK,CAACE,MAAN,CAAaV,IAAd,GAAqBS;AADT,KAAd;AAGD;;AAEDE,EAAAA,OAAO,CAACZ,MAAD,EAASC,IAAT,EAAe;AACpB,SAAKM,UAAL,CAAgBP,MAAhB,EAAwBC,IAAxB;AACD;;AAEDtB,EAAAA,SAAS,CAACkC,GAAD,EAAMf,WAAN,EAAmBgB,UAAnB,EAA+B;AACtC;AACA,QAAIhB,WAAW,IAAI,CAAnB,EAAsB;AACpB;AACD,KAJqC,CAMtC;;;AACA,QAAIH,QAAQ,GAAG,KAAKvC,KAAL,CAAWU,KAA1B;AACA6B,IAAAA,QAAQ,CAACkB,GAAD,CAAR,CAAcf,WAAd,GAA4B,CAACH,QAAQ,CAACkB,GAAD,CAAR,CAAcf,WAAf,GAA6B,CAACA,WAA1D;AACAH,IAAAA,QAAQ,CAACkB,GAAD,CAAR,CAAcV,QAAd,GAAyB,CAACR,QAAQ,CAACkB,GAAD,CAAR,CAAcV,QAAf,GAA0B,CAACL,WAApD;AACAH,IAAAA,QAAQ,CAACkB,GAAD,CAAR,CAAcC,UAAd,GAA2BA,UAA3B;AACA,SAAKpB,QAAL,CAAe;AAAC5B,MAAAA,KAAK,EAAE6B;AAAR,KAAf,EAXsC,CAatC;;AACA,QAAIC,OAAO,GAAG,KAAKxC,KAAL,CAAWF,IAAzB;AACA,QAAI6D,YAAY,GAAG,KAAnB;AACA,QAAIC,UAAU,GAAG,KAAjB,CAhBsC,CAiBtC;AACA;AACA;;AACA,SAAK,IAAInB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,OAAO,CAACH,MAA5B,EAAoCI,CAAC,EAArC,EAAyC;AACvC;AACA,UAAIF,QAAQ,CAACkB,GAAD,CAAR,CAAcb,MAAd,CAAqB,CAArB,EAAwBC,IAAxB,KAAiCL,OAAO,CAACC,CAAD,CAAP,CAAW,CAAX,EAAcG,MAAd,CAAqB,CAArB,EAAwBC,IAA7D,EAAmE;AACjEc,QAAAA,YAAY,GAAG,IAAf,CADiE,CAEjE;;AACA,aAAK,IAAIhB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGH,OAAO,CAACC,CAAD,CAAP,CAAWJ,MAA/B,EAAuCM,CAAC,EAAxC,EAA4C;AAC1C;AACA,cAAIJ,QAAQ,CAACkB,GAAD,CAAR,CAAcZ,IAAd,KAAuBL,OAAO,CAACC,CAAD,CAAP,CAAWE,CAAX,EAAcE,IAAzC,EAA+C;AAC7Ce,YAAAA,UAAU,GAAG,IAAb;AACApB,YAAAA,OAAO,CAACC,CAAD,CAAP,CAAWE,CAAX,EAAcD,WAAd,GAA4BH,QAAQ,CAACkB,GAAD,CAAR,CAAcf,WAA1C;AACD;AACF,SATgE,CAUjE;;;AACA,YAAI,CAACkB,UAAL,EAAiB;AACfpB,UAAAA,OAAO,CAACC,CAAD,CAAP,CAAWoB,IAAX,CAAgBtB,QAAQ,CAACkB,GAAD,CAAxB;AACD;AACF;AACF,KArCqC,CAsCtC;;;AACA,QAAI,CAACE,YAAL,EAAmB;AACjBnB,MAAAA,OAAO,CAACqB,IAAR,CAAa,EAAb;AACArB,MAAAA,OAAO,CAACA,OAAO,CAACH,MAAR,GAAiB,CAAlB,CAAP,CAA4BwB,IAA5B,CAAiCtB,QAAQ,CAACkB,GAAD,CAAzC;AACD;;AACD,SAAKnB,QAAL,CAAc;AAAExC,MAAAA,IAAI,EAAE0C;AAAR,KAAd;AACD;;AAEDf,EAAAA,MAAM,GAAE;AACNtB,IAAAA,QAAQ,CAACC,MAAT,GAAkB,QAAlB;AACA,SAAKkC,QAAL,CAAc;AAACzC,MAAAA,IAAI,EAAE;AAAP,KAAd;AACD;;AAED6B,EAAAA,cAAc,GAAG;AACf,SAAKY,QAAL,CAAc;AAAElB,MAAAA,YAAY,EAAE;AAAhB,KAAd;AACD;;AAEDI,EAAAA,UAAU,GAAG;AACX,SAAKc,QAAL,CAAc;AAAEpB,MAAAA,QAAQ,EAAE;AAAZ,KAAd;AACD;;AAED4C,EAAAA,WAAW,GAAG;AACZ,QAAI,KAAK9D,KAAL,CAAWU,KAAX,CAAiB2B,MAAjB,IAA2B,CAA/B,EAAkC;AAChC,0BACE;AAAA,kBAAK,KAAKrC,KAAL,CAAWiB;AAAhB;AAAA;AAAA;AAAA;AAAA,cADF;AAGD;;AACD,QAAI8C,KAAK,GAAG,EAAZ;;AACA,SAAK,IAAItB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKzC,KAAL,CAAWU,KAAX,CAAiB2B,MAArC,EAA6CI,CAAC,EAA9C,EAAkD;AAChDsB,MAAAA,KAAK,CAACF,IAAN,eAAW,QAAC,IAAD;AAEH,QAAA,EAAE,EAAEpB,CAFD;AAGH,QAAA,MAAM,EAAE,KAAKzC,KAAL,CAAWU,KAAX,CAAiB+B,CAAjB,EAAoBG,MAApB,CAA2B,CAA3B,EAA8BC,IAHnC;AAIH,QAAA,IAAI,EAAE,KAAK7C,KAAL,CAAWU,KAAX,CAAiB+B,CAAjB,EAAoBI,IAJvB;AAKH,QAAA,KAAK,EAAE,KAAK7C,KAAL,CAAWU,KAAX,CAAiB+B,CAAjB,EAAoBuB,KALxB;AAMH,QAAA,MAAM,EAAE,KAAKhE,KAAL,CAAWU,KAAX,CAAiB+B,CAAjB,EAAoBM,QANzB;AAOH,QAAA,MAAM,EAAE,KAAK/C,KAAL,CAAWU,KAAX,CAAiB+B,CAAjB,EAAoBG,MAApB,CAA2B,CAA3B,EAA8BqB,OAPnC;AAQH,QAAA,QAAQ,EAAE,KAAKjE,KAAL,CAAWU,KAAX,CAAiB+B,CAAjB,EAAoByB,WAR3B;AASH,QAAA,SAAS,EAAE,KAAK3C;AATb,SACEkB,CADF;AAAA;AAAA;AAAA;AAAA,cAAX;AAWD;;AACD,WAAOsB,KAAP;AACD;;AAEDI,EAAAA,MAAM,GAAG;AACP;AACA,QAAI,KAAKnE,KAAL,CAAWH,IAAX,KAAoB,EAAxB,EAA4B;AACxB,0BACE,QAAC,QAAD;AAAU,QAAA,EAAE,EAAC;AAAb;AAAA;AAAA;AAAA;AAAA,cADF;AAGH;;AAED,QAAI,KAAKG,KAAL,CAAWkB,QAAf,EAAyB;AACvB;AAAA;AACE;AACA,gBAAC,QAAD;AAAU,UAAA,EAAE,EAAE;AAAEkD,YAAAA,QAAQ,EAAE,WAAZ;AAAyBpE,YAAAA,KAAK,EAAE;AAAEH,cAAAA,IAAI,EAAE,KAAKG,KAAL,CAAWH,IAAnB;AAAyBC,cAAAA,IAAI,EAAE,KAAKE,KAAL,CAAWF;AAA1C;AAAhC;AAAd;AAAA;AAAA;AAAA;AAAA;AAFF;AAID;;AAED,QAAI,KAAKE,KAAL,CAAWoB,YAAf,EAA6B;AAC3B;AAAA;AACE;AACA,gBAAC,QAAD;AAAU,UAAA,EAAE,EAAE;AAAEgD,YAAAA,QAAQ,EAAE,eAAZ;AAA6BpE,YAAAA,KAAK,EAAE;AAAEH,cAAAA,IAAI,EAAE,KAAKG,KAAL,CAAWH,IAAnB;AAAyBC,cAAAA,IAAI,EAAE,KAAKE,KAAL,CAAWF;AAA1C;AAApC;AAAd;AAAA;AAAA;AAAA;AAAA;AAFF;AAID;;AAED,wBACE,QAAC,KAAD,CAAO,QAAP;AAAA,6BACE;AAAS,QAAA,SAAS,EAAC,mBAAnB;AAAA,gCACE;AAAI,UAAA,SAAS,EAAC,YAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBADF,eAEE;AAAK,UAAA,SAAS,EAAC,MAAf;AAAA,kCACE;AAAQ,YAAA,KAAK,EAAC,OAAd;AAAsB,YAAA,SAAS,EAAC,cAAhC;AAA+C,YAAA,OAAO,EAAE,KAAK0B,UAA7D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBADF,eAIE;AAAQ,YAAA,KAAK,EAAE;AAAE6C,cAAAA,KAAK,EAAE;AAAT,aAAf;AAAkC,YAAA,SAAS,EAAC,cAA5C;AAA2D,YAAA,OAAO,EAAE,KAAK5C,MAAzE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAJF,eAOE;AAAQ,YAAA,KAAK,EAAE;AAAE4C,cAAAA,KAAK,EAAE;AAAT,aAAf;AAAkC,YAAA,SAAS,EAAC,cAA5C;AAA2D,YAAA,OAAO,EAAE,KAAK3C,cAAzE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAPF;AAAA;AAAA;AAAA;AAAA;AAAA,gBAFF,eAaE;AAAA;AAAA;AAAA;AAAA,gBAbF,eAcE;AAAA;AAAA;AAAA;AAAA,gBAdF,EAeG,KAAKoC,WAAL,EAfH,eAiBE;AAAA;AAAA;AAAA;AAAA,gBAjBF;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,YADF;AAwBD;;AA7P+C;;AAgQlD,MAAMQ,IAAN,SAAmB/E,KAAK,CAACG,SAAzB,CAAmC;AACjCC,EAAAA,WAAW,CAACC,KAAD,EAAQ;AACjB,UAAMA,KAAN;AACA,SAAKI,KAAL,GAAa;AACX0C,MAAAA,WAAW,EAAE,CADF;AAEXgB,MAAAA,UAAU,EAAE;AAFD,KAAb;AAIA,SAAKrC,gBAAL,GAAsB,KAAKA,gBAAL,CAAsBC,IAAtB,CAA2B,IAA3B,CAAtB;AACD;;AAEDD,EAAAA,gBAAgB,CAACgC,KAAD,EAAQ;AACtB,QAAIC,KAAK,GAAGD,KAAK,CAACE,MAAN,CAAaD,KAAzB;;AACA,QAAIA,KAAK,GAAG,KAAK1D,KAAL,CAAW2E,MAAvB,EAA+B;AAC7BjB,MAAAA,KAAK,GAAG,KAAK1D,KAAL,CAAW2E,MAAnB;AACD,KAFD,MAEO,IAAIjB,KAAK,GAAG,CAAZ,EAAe;AACpBA,MAAAA,KAAK,GAAG,CAAR;AACD;;AACD,SAAKhB,QAAL,CAAc;AACZ,OAACe,KAAK,CAACE,MAAN,CAAaV,IAAd,GAAqBS;AADT,KAAd;AAGD;;AAEDa,EAAAA,MAAM,GAAI;AACR,wBACE;AAAK,MAAA,SAAS,EAAC,aAAf;AAAA,6BACE;AAAK,QAAA,SAAS,EAAC,YAAf;AAA4B,QAAA,KAAK,EAAC,QAAlC;AAAA,gCACE;AAAA,iCAAY,KAAKvE,KAAL,CAAWgD,MAAvB;AAAA;AAAA;AAAA;AAAA;AAAA,gBADF,eAEE;AAAA,+BAAU,KAAKhD,KAAL,CAAWiD,IAArB;AAAA;AAAA;AAAA;AAAA;AAAA,gBAFF,eAGE;AAAA,iCAAY,KAAKjD,KAAL,CAAWoE,KAAvB;AAAA;AAAA;AAAA;AAAA;AAAA,gBAHF,eAIE;AAAA,iCAAY,KAAKpE,KAAL,CAAW2E,MAAvB;AAAA;AAAA;AAAA;AAAA;AAAA,gBAJF,eAKE;AAAA,iCAAY,KAAK3E,KAAL,CAAW4E,MAAvB;AAAA;AAAA;AAAA;AAAA;AAAA,gBALF,eAME;AAAA,oCAAe,KAAK5E,KAAL,CAAW6E,QAA1B;AAAA;AAAA;AAAA;AAAA;AAAA,gBANF,eAQE;AAAQ,UAAA,SAAS,EAAC,YAAlB;AAA+B,UAAA,OAAO,EAAE,MAAM;AAC5C,iBAAK7E,KAAL,CAAW2B,SAAX,CAAqB,KAAK3B,KAAL,CAAWa,EAAhC,EAAoC,KAAKT,KAAL,CAAW0C,WAA/C,EAA4D,KAAK1C,KAAL,CAAW0D,UAAvE;AACA,iBAAKpB,QAAL,CAAc;AAAEI,cAAAA,WAAW,EAAE;AAAf,aAAd;AACD,WAHD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBARF,2BAYU;AAAO,UAAA,IAAI,EAAC,QAAZ;AAAqB,UAAA,SAAS,EAAC,aAA/B;AAA6C,UAAA,IAAI,EAAC,aAAlD;AAAgE,UAAA,GAAG,EAAC,GAApE;AAAwE,UAAA,GAAG,EAAE,KAAK9C,KAAL,CAAW2E,MAAxF;AAAgG,UAAA,KAAK,EAAE,KAAKvE,KAAL,CAAW0C,WAAlH;AAA+H,UAAA,QAAQ,EAAE,KAAKrB;AAA9I;AAAA;AAAA;AAAA;AAAA,gBAZV;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,YADF;AAkBD;;AAzCgC","sourcesContent":["import React from 'react';\nimport { Redirect } from \"react-router-dom\";\n\nimport '@fortawesome/fontawesome-free/css/all.min.css'; \nimport 'bootstrap-css-only/css/bootstrap.min.css'; \nimport './FoodItems.css'\n\nexport default class Shop extends React.Component {\n  constructor(props) {\n    super(props);\n\n    var user;\n    let cart = [];\n    if (this.props.location.state === undefined) {\n      user = \"\";\n    } else {\n      user = this.props.location.state.user;\n      cart = this.props.location.state.cart;\n    }\n    \n    let token = document.cookie.split('; ').find(row => row.startsWith('token'));\n    if (token === undefined) {\n      user = \"\";\n    }\n    token = token.split('=')[1];\n\n    this.state = {\n      user: user,\n      id: 0,\n      //All food items for sale\n      items: [],\n      //Food items in buyer's cart - passed to checkout.js and back\n      cart: cart,\n      newSeller: \"\",\n      newName: \"\",\n      newPrice: \"\",\n      newAmount: \"\",\n      newPickup: \"\",\n      newDelivery: \"\",\n      token: token,\n      message: \"\",\n      checkout: false,\n      logout: false,\n      orderHistory: false,\n    };\n    this.handleTextChange=this.handleTextChange.bind(this);\n    this.addToCart=this.addToCart.bind(this);\n    this.onCheckout=this.onCheckout.bind(this);\n    this.logOut=this.logOut.bind(this);\n    this.onOrderHistory=this.onOrderHistory.bind(this);\n  }\n\n  componentDidMount() {\n    this.getFoodItems();\n  }\n\n  async getFoodItems(){\n    await fetch('http://localhost:8080/foodItems', {\n      method: 'GET',\n      credentials: 'include',\n      headers: {\n        'authorization': `Bearer ${this.state.token}`,\n      },\n    })\n    .then(response => response.json())\n    .then(responseJSON => {\n      if (responseJSON.length <= 0) {\n        this.setState({ message: \"No items in the shop, sorry!\" });\n      }\n\n      let newItems = responseJSON;\n      let newCart = this.state.cart;\n      for (let i = 0; i < newItems.length; i++) {\n        newItems[i].amountToBuy = 0;\n        // Check if seller exists in cart\n        for (let j = 0; j < newCart.length; j++) {\n          // If yes, loop through the array of items corresponding to the seller in the cart\n          if (newItems[i].seller[0].name === newCart[j][0].seller[0].name) {\n            // Check if item exists in cart\n            for (let k = 0; k < newCart[j].length; k++) {\n              // If yes\n              if (newItems[i].name === newCart[j][k].name) {\n                // Update the amount to buy and quantity of the displayed item to match the corresponding item in the cart\n                newItems[i].amountToBuy = newCart[j][k].amountToBuy;\n                newItems[i].quantity = +newItems[i].quantity - +newItems[i].amountToBuy;\n              }\n            }\n          }\n        }\n      }\n\n      // Do not display items that have a quantity of 0\n      for (let i = newItems.length - 1; i >= 0; i--) {\n        if (newItems[i].quantity <= 0) {\n          newItems.splice(i, 1);\n        }\n      }\n      \n      this.setState({items: newItems});\n    })\n    .catch(err => {\n      // this.setState({ user: \"\" });\n      // Do nothing, will be redirected back to home page\n      // throw new Error(err)\n    })\n  }\n\n  async deleteFood(name) {\n    await fetch(`http://localhost:8080/foodItems/${name}`, {\n      method: 'DELETE',\n      credentials: 'include',\n      headers: {\n        'Authorization': `Bearer ${this.state.token}`,\n      },\n    })\n    .then(() => this.getFoodItems())\n    .catch(err => {\n      throw new Error(err)\n    })\n  }\n\n  handleTextChange(event) {\n    const value = event.target.value;\n    this.setState({\n      [event.target.name]: value\n    });\n  }\n\n  discard(seller, name) {\n    this.deleteFood(seller, name);\n  }\n\n  addToCart(idx, amountToBuy, isDelivery) {\n    // Error checking, cannot buy amount of 0\n    if (amountToBuy <= 0) {\n      return;\n    }\n\n    // Update displayed item\n    var newItems = this.state.items;\n    newItems[idx].amountToBuy = +newItems[idx].amountToBuy + +amountToBuy;\n    newItems[idx].quantity = +newItems[idx].quantity - +amountToBuy;\n    newItems[idx].isDelivery = isDelivery;\n    this.setState( {items: newItems });\n\n    // Update cart\n    let newCart = this.state.cart;\n    var sellerInCart = false;\n    var itemInCart = false;\n    // Find array corresponding to the correct seller\n    // The cart is a 2d array structured as an array of arrays of items corresponding to each seller\n    // [sellers][items]\n    for (let i = 0; i < newCart.length; i++) { \n      // Found array corresponding to correct seller\n      if (newItems[idx].seller[0].name === newCart[i][0].seller[0].name) {\n        sellerInCart = true;\n        // Find item\n        for (let j = 0; j < newCart[i].length; j++) {\n          // Found item\n          if (newItems[idx].name === newCart[i][j].name) {\n            itemInCart = true;\n            newCart[i][j].amountToBuy = newItems[idx].amountToBuy;\n          }\n        }\n        // If item not found, add it to cart\n        if (!itemInCart) {\n          newCart[i].push(newItems[idx]);\n        }\n      }\n    }\n    // If correct seller array not found, add the item to a new array in the cart\n    if (!sellerInCart) {\n      newCart.push([]);\n      newCart[newCart.length - 1].push(newItems[idx]);\n    }\n    this.setState({ cart: newCart });\n  }\n\n  logOut(){\n    document.cookie = \"token=\";\n    this.setState({user: \"\"});\n  }\n\n  onOrderHistory() {\n    this.setState({ orderHistory: true });\n  }\n\n  onCheckout() {\n    this.setState({ checkout: true });\n  }\n\n  renderCards() {\n    if (this.state.items.length <= 0) {\n      return (\n        <h2>{this.state.message}</h2>\n      );\n    }\n    var cards = [];\n    for (let i = 0; i < this.state.items.length; i++) {\n      cards.push(<Card\n              key={i}\n              id={i}\n              seller={this.state.items[i].seller[0].name}\n              name={this.state.items[i].name}\n              price={this.state.items[i].price}\n              amount={this.state.items[i].quantity}\n              pickup={this.state.items[i].seller[0].address}\n              delivery={this.state.items[i].deliveryFee}\n              addToCart={this.addToCart}\n            />);\n    }\n    return cards;\n  }\n\n  render() {\n    // If no user is logged in\n    if (this.state.user === \"\") {\n        return(\n          <Redirect to=\"/\" />\n        );\n    }\n\n    if (this.state.checkout) {\n      return (\n        //Redirect to checkout.js with the user and their cart\n        <Redirect to={{ pathname: '/Checkout', state: { user: this.state.user, cart: this.state.cart } }} />\n      );\n    }\n\n    if (this.state.orderHistory) {\n      return (\n        //Redirect to orderHistory.js with the user and their cart\n        <Redirect to={{ pathname: '/OrderHistory', state: { user: this.state.user, cart: this.state.cart } }} />\n      );\n    }\n\n    return (\n      <React.Fragment>\n        <section className=\"content-container\">\n          <h1 className=\"pageheader\">Shop</h1>\n          <div className=\"rows\">\n            <button align=\"right\" className=\"selectButton\" onClick={this.onCheckout}>\n              View Cart\n            </button>\n            <button style={{ float: 'right'}} className=\"selectButton\" onClick={this.logOut}>\n            Log Out\n            </button>\n            <button style={{ float: 'right'}} className=\"selectButton\" onClick={this.onOrderHistory}>\n            Order History\n            </button>\n          </div>\n          <br />\n          <br />\n          {this.renderCards()}\n          \n          <br />\n\n        </section>\n      </React.Fragment>\n    );\n  }\n}\n\nclass Card extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      amountToBuy: 0,\n      isDelivery: false,\n    };\n    this.handleTextChange=this.handleTextChange.bind(this);\n  }\n\n  handleTextChange(event) {\n    let value = event.target.value;\n    if (value > this.props.amount) {\n      value = this.props.amount;\n    } else if (value < 0) {\n      value = 0;\n    }\n    this.setState({\n      [event.target.name]: value\n    });\n  }\n\n  render () {\n    return (\n      <div className=\"itemColumns\">\n        <div className=\"itemValues\" align=\"center\">\n          <p>Seller: {this.props.seller}</p>\n          <p>Name: {this.props.name}</p>\n          <p>Price: ${this.props.price}</p>\n          <p>Amount: {this.props.amount}</p>\n          <p>Pickup: {this.props.pickup}</p>\n          <p>Delivery: ${this.props.delivery}</p>\n\n          <button className=\"itemButton\" onClick={() => {\n            this.props.addToCart(this.props.id, this.state.amountToBuy, this.state.isDelivery);\n            this.setState({ amountToBuy: 0 });\n          }}>Add to Cart</button>\n          Amount: <input type=\"number\" className=\"amountInput\" name=\"amountToBuy\" min='0' max={this.props.amount} value={this.state.amountToBuy} onChange={this.handleTextChange}></input>\n        </div>\n      </div>\n    );\n  }\n}"]},"metadata":{},"sourceType":"module"}